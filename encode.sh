#!/bin/bash -e

ffmpeg -i undertale.mp4 -i deltarune.mp4 -f rawvideo -pix_fmt rgba -s 640x120 -r 30 -i <(go run readout.go) -filter_complex 'nullsrc=size=2560x1440 [base]; movie=tas-splash.png:loop=90,setpts=N/(30*TB) [splash]; [base][splash] overlay [tmp0]; [0:v] setpts=PTS+6/TB,scale=1280:960:flags=neighbor [left]; [tmp0][left] overlay=shortest=1 [tmp1]; [1:v] setpts=PTS+6/TB [right]; [tmp1][right] overlay=shortest=1:x=1280 [tmp2]; [2:v] scale=2560:480:flags=neighbor [bottom]; [tmp2][bottom] overlay=shortest=1:y=960 [vout]; [0:a][1:a] amerge=inputs=2,pan=stereo|c0<c0+c1|c1<c2+c3,asetpts=PTS+6/TB [aout]' -map '[vout]' -map '[aout]' -crf 0 -movflags +faststart -y tas.mp4
